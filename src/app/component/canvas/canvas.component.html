<button class="add-btn" (click)="addNode(NodeType.Middleware)">Add Generic Node</button>
<div class="canvas-container" (mousedown)="onMouseDown($event)" (mousemove)="onMouseMove($event)"
  (mouseup)="onMouseUp()">
  <div class="virtual-space" [ngStyle]="{'transform': 'translate(' + panX + 'px, ' + panY + 'px)'}">
    <ng-container *ngFor="let node of nodes$ | async">
      <app-server *ngIf="node.type === NodeType.Server" [nodeName]="node.name" [position]="node.position"
        [nodeId]="node.id" [port]="node.port!" [dburl]="node.dbUrl!" [env]="node.enviroment!"
        (startConnection)="startConnection($event)" (mouseup)="endConnection({ node: node })"
        (nodeMoved)="onNodeMoved($event)" (dragStarted)="onDragStarted()"
        (dragEnded)="onDragEnded($event)"></app-server>
      <app-route *ngIf="node.type === NodeType.Route" [nodeName]="node.name" [position]="node.position"
        [nodeId]="node.id" (startConnection)="startConnection($event)" (mouseup)="endConnection({ node: node })"
        (nodeMoved)="onNodeMoved($event)" (dragStarted)="onDragStarted()" (dragEnded)="onDragEnded($event)"></app-route>
      <app-middleware *ngIf="node.type === NodeType.Middleware" [nodeName]="node.name" [position]="node.position"
        [nodeId]="node.id" [code]="node.content!" (nodeMoved)="onNodeMoved($event)" (dragStarted)="onDragStarted()"
        (mouseup)="endConnection({ node: node })" (dragEnded)="onDragEnded($event)"
        (nodeSelected)="openEditor()"></app-middleware>
    </ng-container>
    <svg class="connections" [ngStyle]="{'transform': 'translate(' + -panX + 'px, ' + -panY + 'px)'}">
      <!-- Define neon glow filter -->
      <defs>
        <filter id="neon">
          <feGaussianBlur stdDeviation="3.5" result="coloredBlur"></feGaussianBlur>
          <feMerge>
            <feMergeNode in="coloredBlur"></feMergeNode>
            <feMergeNode in="SourceGraphic"></feMergeNode>
          </feMerge>
        </filter>
      </defs>

      <!-- Render connections with neon effect -->
      <path *ngFor="let connection of connections$ | async"
        [attr.d]="generatePath(connection.fromNode, connection.toNode)" stroke="cyan" stroke-width="2" fill="none"
        filter="url(#neon)" />
      <path *ngIf="drawingConnection" [attr.d]="generatePath(drawingConnection.fromNode, { position: cursorPosition })"
        stroke="red" stroke-width="2" fill="none" filter="url(#neon)" />
    </svg>
  </div>
  <div class="editor-panel" [ngClass]="{'open': isEditorOpen}">
    <app-editor></app-editor>
  </div>
</div>